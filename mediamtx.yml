# mediaMTX configuration for LiveU relay and clean-feed recording

# Log level: debug, info, warn, error
logLevel: info

# API server (for monitoring)
api: yes
apiAddress: :9997

# RTSP server (needed for forwarding)
rtsp: yes
rtspAddress: :8554

# RTMP server
rtmp: yes
rtmpAddress: :1935

# Paths define stream endpoints
paths:
  # Main LiveU ingest path
  liveu:
    # Accept any source (SRT, RTMP, RTSP, etc.)
    source: publisher

    # Recording configuration
    record: yes
    recordPath: /vod/%path/%Y-%m-%d_%H-%M-%S
    recordFormat: fmp4
    recordPartDuration: 1s
    recordSegmentDuration: 1h # 1 hour segments
    recordDeleteAfter: 0s # Keep files indefinitely (manual cleanup)

    # Forward to IRLToolkit when stream starts (reads /config/forward.env)
    runOnReady: /usr/local/bin/forward.sh
    runOnReadyRestart: yes
    # Trigger upload and email when stream ends
    runOnNotReady: /usr/local/bin/on_end.sh liveu

  # Verification path for local testing (receives forwarded stream)
  verify:
    source: publisher
    # No recording needed for test verification path
