# mediaMTX configuration for LiveU relay and clean-feed recording

# Log level: debug, info, warn, error
logLevel: info

# Authentication - use internal database with static credentials
authInternalUsers:
  - user: liveu
    pass: ${MTX_INGEST_KEY}
    permissions:
      - action: publish
        path: liveu
      - action: read
        path: liveu
  # Allow anonymous access to srttest for testing
  - user: any
    pass:
    permissions:
      - action: publish
        path: srttest

# API server (for monitoring)
api: yes
apiAddress: :9997

# RTSP server (needed for forwarding)
rtsp: yes
rtspAddress: :8554

# RTMP server
rtmp: yes
rtmpAddress: :1935

# SRT server (Secure Reliable Transport)
srt: yes
srtAddress: :8890

# Paths define stream endpoints
paths:
  # Main LiveU ingest path
  liveu:
    # Accept any source
    source: publisher

    # Recording configuration
    record: yes
    recordPath: /vod/%path/%Y-%m-%d_%H-%M-%S
    recordFormat: fmp4
    recordPartDuration: 10s
    recordMaxPartSize: 100M
    recordSegmentDuration: 1h
    recordDeleteAfter: 0s

    # Forward to external service when stream starts
    runOnReady: /usr/local/bin/forward.sh
    runOnReadyRestart: yes
    # Upload and email when stream ends
    runOnNotReady: /usr/local/bin/on_end.sh liveu

  # Test SRT path (no authentication required for initial debugging)
  srttest:
    source: publisher
    record: no
